
- name: "Copy consul.hcl configuration"
  vars:
    server_index: "{{ lookup('ansible.utils.index_of', groups['consul_servers'], 'eq', inventory_hostname) }}"
    server: True
  template:
    src: templates/consul.j2
    dest: "{{ consul_config }}consul.hcl"
    owner: "{{ username }}"
  notify: Restart consul

- name: "Copy server.hcl configuration"
  template:
    src: templates/consul_server.j2
    dest: "{{ consul_config }}server.hcl"
    owner: "{{ username }}"
  vars:
    server_new: False
  notify: Restart consul
