- name: "Set consul bootstrap token path"
  set_fact:
    consul_token_path: "{{ path }}{{ new_certs }}/{{ inventory_hostname }}_consul_token"
  when: consul_add_tokens_server or consul_add_tokens_client

- name: "Set consul bootstrap token path"
  set_fact:
    consul_token_path: "{{ consul_fetched_dir }}/{{ inventory_hostname }}_consul_token"
  when: consul_tokens_server or consul_tokens_client

- name: Get ACL Token
  set_fact:
    consul_token: "{{ lookup('file', consul_token_path)| regex_search(regexp,'\\1') | first }}"
  vars:
    regexp: 'SecretID:\s+(.*)'