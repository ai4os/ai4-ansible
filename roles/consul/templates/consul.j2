datacenter = "{{ consul_dc_name }}"
data_dir = "{{ consul_data_dir }}"
encrypt = "{{ consul_keygen }}"                 # ENCRYPTION_KEY generated by 'consul keygen'
{% if ("consul_master" in groups and inventory_hostname in groups["consul_master"]) or ("consul_new_master" in groups and inventory_hostname in groups["consul_new_master"]) %}
bootstrap = true
{% endif %}
node_name = "{{ consul_hostname }}"
primary_datacenter = "{{ primary_datacenter }}" 

acl = {
 enabled = true
}

tls {
  defaults {
    ca_file = "{{ consul_certs }}consul-agent-ca.pem"
{% if server %}
    cert_file = "{{ consul_certs }}{{ consul_dc_name }}-server-consul-{{ server_index }}.pem"       # In case of consul client and auto encryption TLS, remove this line
    key_file = "{{ consul_certs }}{{ consul_dc_name }}-server-consul-{{ server_index }}-key.pem"    # In case of consul client and auto encryption TLS, remove this line
{% endif %}
 
    verify_incoming = true
    verify_outgoing = true
  }
  internal_rpc {
    verify_server_hostname = true
  }
}
 
auto_encrypt {
{% if server %}
  allow_tls = true               # In case of client comment this line
{% else %}
  tls = true                   # In case of client uncomment this line
{% endif %}
}

 

{% if server %}
retry_join_wan = {{ consul_servers_ip | to_json }}  # This must be a public IP(s) used for all servers/clients in the federation
{% endif %}
retry_join = ["{{ consul_public_ip}}"]  # This must be a public IP(s) used for all servers/clients in the datacenter
